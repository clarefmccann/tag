---
title: "Score_Qualtrics"
author: "Cameron"
date: "20 February 2017"
output: html_document
---

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Before you begin

# Begin script

What computer you at? Possibilities are "bart" and "katelaptop"
```{r}
rm(list = ls())
Computer="bart"
```

```{r}
if (Computer=="bart"){
  analysis_root="/Volumes/klmills/RDoCdb/"
  processed_data="/Volumes/research/dsnlab/Studies/TAG/behavioral/processed/"
} else if (Computer=="katelaptop"){
  analysis_root="/Volumes/klmills/RDoCdb/"
  processed_data="/Volumes/research/dsnlab/Studies/TAG/behavioral/processed/"
} else {
  print("No Computer specified")
}
```

Load required packages
```{r}
## Load required packages ##
packages <- c("R.matlab", "lme4", "R.utils", "R.oo", "nlme", "ggplot2", "zoo",
              "dplyr", "tidyr", "knitr", "parallel", "data.table", "lubridate")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
  install.packages(setdiff(packages, rownames(installed.packages())))  
}
lapply(packages, library, character.only = TRUE)
```

Load redcap data and qualtrics data
```{r}
redcapData <- read.csv(paste0(processed_data,"redcap/TAG_redcapData.csv"), header = TRUE, stringsAsFactors = FALSE)
qualtricsData_raw_long <- read.csv(paste0(processed_data,"qualtrics/TAG_auto_raw_qualtrics_long_kate.csv"), header = TRUE, stringsAsFactors = FALSE)
qualtricsData_raw_long <- qualtricsData_raw_long %>% mutate(tagid=sprintf("TAG%03s",SID)) %>% select(tagid, item, value, survey_name)
qualtricsData_raw_long$tagid<-replace(qualtricsData_raw_long$tagid, qualtricsData_raw_long$tagid=="TAG0NA", "TAG070")
```

Prepare subject identifying information
```{r}
participant_info <- redcapData %>%
  mutate(tagid=sprintf("TAG%03d",SID)) %>%
  arrange(tagid) %>%
  select(-age, -SID) %>%
  filter(!is.na(dob))
```

Figure out duplicates
```{r}

#Step 1: Define your questionnaire measure. Possibilities: K_SRQ, IRI, PDS
questionnaire<-"K_SRQ"

# Now highlight the next segment until you read # STOP # and run
checkoutduplicates<-filter(qualtricsData_raw_long, grepl(questionnaire,item)) %>% 
  mutate(value=as.numeric(value)) %>%
  filter(!is.na(value)) %>%
  distinct(tagid,item,value,.keep_all = TRUE)

duplicates<-checkoutduplicates %>%
  spread(item,value)

# STOP #
######################

# Now check each of the rows #
checkoutduplicates[583:584,]

# To figure out the timestamp just enter in one of the rows from above here:
rownum<-583
qualtricsData_raw_long %>%
  filter(tagid %in% checkoutduplicates$tagid[rownum]) %>%
  filter(survey_name %in% checkoutduplicates$survey_name[rownum]) %>%
  filter(item=="EndDate")
# Now compare the timestamps to those in Google Calendar for TAG

```


```{r}
ethnicity <- parentqualtrics %>% mutate(tagid=sprintf("TAG%03d",SID)) %>%
  filter(tagid %in% current_subs$TAGID) %>%
  mutate(race=Ethnicity) %>%
  arrange(tagid)
ethnicity$race<-replace(ethnicity$race, ethnicity$Ethnicity=="d. White / Caucasian", "White")
ethnicity$race<-replace(ethnicity$race, ethnicity$Ethnicity=="b. Hispanic/ Latino/ Chicano,d. White / Caucasian", "More than one race")
ethnicity$race<-replace(ethnicity$race, ethnicity$Ethnicity=="d. White / Caucasian,e. Asian", "More than one race")
ethnicity$race<-replace(ethnicity$race, ethnicity$Ethnicity=="c. Native American or Native Alaskan" , "American Indian/Alaska Native")
current_subs <- current_subs %>% arrange(TAGID)
participants <- redcapData %>% mutate(tagid=sprintf("TAG%03d",SID)) %>%
  filter(!is.na(dob),!is.na(sb_date)) %>%
  select(tagid, sa_date, dob) %>%
  filter(tagid %in% current_subs$TAGID) %>%
  arrange(tagid)
participants_ndar_data <- participants %>%
  mutate(subjectkey=current_subs$GUID,
         race=ethnicity$race,
         src_subject_id=tagid,
         interview_date=paste0(sprintf("%02d",month(sa_date)),"/",sprintf("%02d",day(sa_date)),"/",year(sa_date)),
         interview_age=round((interval(start = participants$dob, end = participants$sa_date) / duration(num = 1, units = "months")),0),
         gender="F",
         phenotype="Typical Control",
         phenotype_description="Typical Control",
         twins_study="No",
         sibling_study="No",
         family_study="No",
         sample_taken="Yes",
         sample_id_original="Session1_Saliva",
         sample_description="saliva",
         biorepository_name="NA",
         sample_id_biorepository="NA",
         patient_id_biorepository="NA",
         site="University of Oregon",
         comments_misc="Wave1 Session1",
         study="UO TAG Study")
participants_ndar_data<-left_join(subjectkey,participants_ndar_data, by="tagid") %>%
  mutate(src_subject_id=anontagid) %>%
  select(-tagid,-sa_date,-dob,-anontagid) %>%
  filter(!is.na(subjectkey))
ndar_subject <- as.list(read.csv(paste0(template_data,"ndar_subject01_template.csv"), header = TRUE, stringsAsFactors = FALSE, skip=1))
ndar_subject_df<-data.frame(ndar_subject)
ndar_subject_df<-bind_rows(ndar_subject_df,participants_ndar_data)
ndar_subject_df_header<-rep(NA,length(ndar_subject_df))
ndar_subject_df_header[1]<-read.csv(paste0(template_data,"ndar_subject01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
ndar_subject_df_header[2]<-read.csv(paste0(template_data,"ndar_subject01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]
part2<-colnames(ndar_subject_df)
part3<-as.matrix(ndar_subject_df)
colnames(part3)<-NULL
together<-rbind(ndar_subject_df_header,part2,part3)
write.table(together,file = paste0(analysis_root,"Output/ndar_subject01.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)
```

Prepare K-SRQ
```{r}
qualtricsData_raw_socreward<-left_join(qualtricsData_raw_socreward,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_socreward<-left_join(qualtricsData_raw_socreward,dob, by="tagid") %>% select(-tagid,-value)
ndar_socreward_data <- ndar_subject %>%
  select(subjectkey, src_subject_id, study, site)
ndar_socreward_data <- left_join(ndar_socreward_data,qualtricsData_raw_socreward,by="src_subject_id")
ndar_socreward_data <- ndar_socreward_data %>% filter(!is.na(survey_date))
ndar_socreward_data <- ndar_socreward_data %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc=paste0(visit=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                                           ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                                                  ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                                         ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                                                ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",
                                                                       NA))))),"; doi:10.3389/fpsyg.2014.00201; Question about kissing not collected."),
         version_form="Child version",
         gender="F",
         ksrq_1=K_SRQ_1,
         ksrq_2=K_SRQ_2,
         ksrq_3=K_SRQ_3,
         ksrq_4=K_SRQ_4,
         ksrq_5=K_SRQ_5,
         ksrq_6=K_SRQ_6,
         ksrq_7=K_SRQ_7,
         ksrq_8=K_SRQ_8,
         ksrq_9=K_SRQ_9,
         ksrq_10=K_SRQ_10,
         ksrq_11=K_SRQ_11,
         ksrq_12=K_SRQ_12,
         ksrq_13=-99,
         ksrq_14=K_SRQ_13,
         ksrq_15=K_SRQ_14,
         ksrq_16=K_SRQ_15,
         ksrq_17=K_SRQ_16,
         ksrq_18=K_SRQ_17,
         ksrq_19=K_SRQ_18,
         ksrq_20=K_SRQ_19,
         ksrq_21=K_SRQ_20,
         ksrq_22=K_SRQ_21,
         ksrq_23=K_SRQ_22,
         ksrq_adm=rowSums(cbind(K_SRQ_1,K_SRQ_7,K_SRQ_11,K_SRQ_17), na.rm=T),
         krsq_negsoc=rowSums(cbind(K_SRQ_3,K_SRQ_5,K_SRQ_13,K_SRQ_16), na.rm=T),
         krsq_pass=rowSums(cbind(K_SRQ_12,K_SRQ_20,K_SRQ_22), na.rm=T),
         krsq_prosoc=rowSums(cbind(K_SRQ_2,K_SRQ_6,K_SRQ_15,K_SRQ_18,K_SRQ_21), na.rm=T),
         krsq_sex=rowSums(cbind(K_SRQ_9,K_SRQ_19), na.rm=T),
         krsq_social=rowSums(cbind(K_SRQ_4,K_SRQ_10,K_SRQ_14), na.rm=T))
ndar_socreward_data <- left_join(subjectkey,ndar_socreward_data, by="src_subject_id") %>%
  mutate(src_subject_id=anontagid) %>%
  filter(!is.na(subjectkey)) %>%
  select(-contains("K_SRQ"),-dob,-survey_date,-survey_name,-tagid,-anontagid)
ndar_socreward_data[, 10:32][is.na(ndar_socreward_data[, 10:32])] <- 88
ndar_socreward_data[, 33:38][is.na(ndar_socreward_data[, 33:38])] <- 999
ndar_subject_df<-bind_rows(socreward_df,ndar_socreward_data)
socreward_df_header<-rep(NA,length(socreward_df))
socreward_df_header[1]<-read.csv(paste0(template_data,"srq01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
socreward_df_header[2]<-read.csv(paste0(template_data,"srq01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]
part2<-colnames(ndar_subject_df)
part3<-as.matrix(ndar_subject_df)
colnames(part3)<-NULL
together<-rbind(socreward_df_header,part2,part3)
write.table(together,file = paste0(analysis_root,"Output/srq01.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)

#NOTE: No total score calculated for this questionnaire
```

Prepare R-SCS-C
```{r}
qualtricsData_raw_rscsc<-filter(qualtricsData_raw_long, grepl("R_SCS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_rscsc<-left_join(qualtricsData_raw_rscsc,survey_date, by = c("tagid", "survey_name")) %>% 
  select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)

qualtricsData_raw_rscsc<-left_join(qualtricsData_raw_rscsc,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_rscsc <- qualtricsData_raw_rscsc %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",
                                           NA))))),
         gender="F",
         rscsc_1=R_SCS_C_1,
         rscsc_2=R_SCS_C_2,
         rscsc_3=R_SCS_C_3,
         rscsc_4=R_SCS_C_4,
         rscsc_5=R_SCS_C_5,
         rscsc_6=R_SCS_C_6,
         rscsc_7=R_SCS_C_7,
         rscsc_8=R_SCS_C_8,
         rscsc_9=R_SCS_C_9,
         rscsc_10=R_SCS_C_10,
         rscsc_11=R_SCS_C_11,
         rscsc_12=R_SCS_C_12,
         rscsc_13=R_SCS_C_13,
         rscsc_14=R_SCS_C_14,
         rscsc_15=R_SCS_C_15,
         rscsc_16=R_SCS_C_16,
         rscsc_17=R_SCS_C_17,
         rscsc_18=R_SCS_C_18,
         rscsc_19=R_SCS_C_19,
         rscsc_20=R_SCS_C_20,
         rscsc_21=R_SCS_C_21,
         rscsc_22=R_SCS_C_22,
         rscsc_23=R_SCS_C_23,
         rscsc_24=R_SCS_C_24,
         rscsc_25=R_SCS_C_25,
         rscsc_26=R_SCS_C_26,
         rscsc_27=R_SCS_C_27,
         rscsc_28=R_SCS_C_28,
         rscsc_29=R_SCS_C_29,
         rscsc_publicsc=rowSums(cbind(R_SCS_C_1,R_SCS_C_2,R_SCS_C_3,R_SCS_C_7,R_SCS_C_10,R_SCS_C_12,R_SCS_C_14,
                           R_SCS_C_15,R_SCS_C_16,R_SCS_C_21,R_SCS_C_28), na.rm=T),
         rscsc_privatesc=rowSums(cbind(R_SCS_C_4,R_SCS_C_5,R_SCS_C_6,R_SCS_C_8,R_SCS_C_9,R_SCS_C_11,R_SCS_C_20,
                            R_SCS_C_22,R_SCS_C_23,R_SCS_C_24,R_SCS_C_27), na.rm=T),
         rscsc_socanx=rowSums(cbind(R_SCS_C_13,R_SCS_C_17,R_SCS_C_18,R_SCS_C_19,R_SCS_C_25,R_SCS_C_26,R_SCS_C_29), na.rm=T))

#NOTE: No total score calculated for this questionnaire
```

Prepare MSPSS
```{r}
qualtricsData_raw_mspss<-filter(qualtricsData_raw_long, grepl("MSPSS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_mspss<-left_join(qualtricsData_raw_mspss,survey_date, by = c("tagid", "survey_name")) %>% 
  select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)

qualtricsData_raw_mspss<-left_join(qualtricsData_raw_mspss,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_mspss <- qualtricsData_raw_mspss %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         timept=1,
         gender="F",
         mspss_1=MSPSS_1,
         mspss_2=MSPSS_2,
         mspss_3=MSPSS_3,
         mspss_4=MSPSS_4,
         mspss_5=MSPSS_5,
         mspss_6=MSPSS_6,
         mspss_7=MSPSS_7,
         mspss_8=MSPSS_8,
         mspss_9=MSPSS_9,
         mspss_10=MSPSS_10,
         mspss_11=MSPSS_11,
         mspss_12=MSPSS_12,
         mspss_fam=rowSums(cbind(MSPSS_3,MSPSS_4,MSPSS_8,MSPSS_11), na.rm=T),
         mspss_fri=rowSums(cbind(MSPSS_6,MSPSS_7,MSPSS_9,MSPSS_12), na.rm=T),
         mspss_so=rowSums(cbind(MSPSS_1,MSPSS_2,MSPSS_5,MSPSS_10), na.rm=T)) %>%
  mutate(mspss_total=rowSums(cbind(mspss_fam+mspss_fri+mspss_so), na.rm=T))
```

Prepare RMET
```{r}
qualtricsData_raw_rmet<-filter(qualtricsData_raw_long, grepl("RMET",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)


qualtricsData_raw_rmet<-left_join(qualtricsData_raw_rmet,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_rmet<-left_join(qualtricsData_raw_rmet,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_rmet <- qualtricsData_raw_rmet %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         visit=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",
                                           NA))))),
         version_form="Child Version",
         gender="F",
         rmet_cv001=RMET_1,
         rmet_cv002=RMET_2,
         rmet_cv003=RMET_3,
         rmet_cv004=RMET_4,
         rmet_cv005=RMET_5,
         rmet_cv006=RMET_6,
         rmet_cv007=RMET_7,
         rmet_cv008=RMET_8,
         rmet_cv009=RMET_9,
         rmet_cv010=RMET_10,
         rmet_cv011=RMET_11,
         rmet_cv012=RMET_12,
         rmet_cv013=RMET_13,
         rmet_cv014=RMET_14)
```

Prepare DSHI (don't re-run because requires manual editing for incompatible entries)
```{r}




qualtricsData_raw_dshi<-filter(qualtricsData_raw_long, grepl("DSHI",item)) %>% distinct(tagid,item,value,.keep_all = TRUE) %>% 
  mutate(value=replace(value, value==1, "Y")) %>%
  mutate(value=replace(value, value==2, "N")) %>%
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_dshi<-left_join(qualtricsData_raw_dshi,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_dshi<-left_join(qualtricsData_raw_dshi,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_dshi <- qualtricsData_raw_dshi %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc="UO TAG Study",
         visit=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",
                                           NA))))),
         gender="F",
         dshi_q1=DSHI_1A,
         dshi_q1a=DSHI_1B_1_TEXT,
         dshi_q1b=DSHI_1B_2_TEXT,
         dshi_q1c=DSHI_1B_3_TEXT,
         dshi_q1d=DSHI_1B_4_TEXT,
         dshi_q1e=DSHI_1B_5_TEXT,
         dshi_q2=DSHI_2A,
         dshi_q2a=DSHI_2B_1_TEXT,
         dshi_q2b=DSHI_2B_2_TEXT,
         dshi_q2c=DSHI_2B_3_TEXT,
         dshi_q2d=DSHI_2B_4_TEXT,
         dshi_q2e=DSHI_2B_5_TEXT,
         dshi_q3=DSHI_3A,
         dshi_q3a=DSHI_3B_1_TEXT,
         dshi_q3b=DSHI_3B_2_TEXT,
         dshi_q3c=DSHI_3B_3_TEXT,
         dshi_q3d=DSHI_3B_4_TEXT,
         dshi_q3e=DSHI_3B_5_TEXT,
         dshi_q4=DSHI_4A,
         dshi_q4a=DSHI_4B_1_TEXT,
         dshi_q4b=DSHI_4B_2_TEXT,
         dshi_q4c=DSHI_4B_3_TEXT,
         dshi_q4d=DSHI_4B_4_TEXT,
         dshi_q4e=DSHI_4B_5_TEXT,
         dshi_q5=DSHI_5A,
         dshi_q5a=DSHI_5B_1_TEXT,
         dshi_q5b=DSHI_5B_2_TEXT,
         dshi_q5c=DSHI_5B_3_TEXT,
         dshi_q5d=DSHI_5B_4_TEXT,
         dshi_q5e=DSHI_5B_5_TEXT,
         dshi_q6=DSHI_6A,
         dshi_q6a=DSHI_6B_1_TEXT,
         dshi_q6b=DSHI_6B_2_TEXT,
         dshi_q6c=DSHI_6B_3_TEXT,
         dshi_q6d=DSHI_6B_4_TEXT,
         dshi_q6e=DSHI_6B_5_TEXT,
         dshi_q7=DSHI_7A,
         dshi_q7a=DSHI_7B_1_TEXT,
         dshi_q7b=DSHI_7B_2_TEXT,
         dshi_q7c=DSHI_7B_3_TEXT,
         dshi_q7d=DSHI_7B_4_TEXT,
         dshi_q7e=DSHI_7B_5_TEXT,
         dshi_q8=DSHI_8A,
         dshi_q8a=DSHI_8B_1_TEXT,
         dshi_q8b=DSHI_8B_2_TEXT,
         dshi_q8c=DSHI_8B_3_TEXT,
         dshi_q8d=DSHI_8B_4_TEXT,
         dshi_q8e=DSHI_8B_5_TEXT,
         dshi_q9=DSHI_9A,
         dshi_q9a=DSHI_9B_1_TEXT,
         dshi_q9b=DSHI_9B_2_TEXT,
         dshi_q9c=DSHI_9B_3_TEXT,
         dshi_q9d=DSHI_9B_4_TEXT,
         dshi_q9e=DSHI_9B_5_TEXT,
         dshi_q10=DSHI_10A,
         dshi_q10a=DSHI_10B_1_TEXT,
         dshi_q10b=DSHI_10B_2_TEXT,
         dshi_q10c=DSHI_10B_3_TEXT,
         dshi_q10d=DSHI_10B_4_TEXT,
         dshi_q10e=DSHI_10B_5_TEXT,
         dshi_q11=DSHI_11A,
         dshi_q11a=DSHI_11B_1_TEXT,
         dshi_q11b=DSHI_11B_2_TEXT,
         dshi_q11c=DSHI_11B_3_TEXT,
         dshi_q11d=DSHI_11B_4_TEXT,
         dshi_q11e=DSHI_11B_5_TEXT,
         dshi_q12=DSHI_12A,
         dshi_q12a=DSHI_12B_1_TEXT,
         dshi_q12b=DSHI_12B_2_TEXT,
         dshi_q12c=DSHI_12B_3_TEXT,
         dshi_q12d=DSHI_12B_4_TEXT,
         dshi_q12e=DSHI_12B_5_TEXT,
         dshi_q13=DSHI_13A,
         dshi_q13a=DSHI_13B_1_TEXT,
         dshi_q13b=DSHI_13B_2_TEXT,
         dshi_q13c=DSHI_13B_3_TEXT,
         dshi_q13d=DSHI_13B_4_TEXT,
         dshi_q13e=DSHI_13B_5_TEXT,
         dshi_q14=DSHI_14A,
         dshi_q14a=DSHI_14B_1_TEXT,
         dshi_q14b=DSHI_14B_2_TEXT,
         dshi_q14c=DSHI_14B_3_TEXT,
         dshi_q14d=DSHI_14B_4_TEXT,
         dshi_q14e=DSHI_14B_5_TEXT,
         dshi_q15=DSHI_15A,
         dshi_q15a=DSHI_15B_1_TEXT,
         dshi_q15b=DSHI_15B_2_TEXT,
         dshi_q15c=DSHI_15B_3_TEXT,
         dshi_q15d=DSHI_15B_4_TEXT,
         dshi_q15e=DSHI_15B_5_TEXT,
         dshi_q16=DSHI_16A,
         dshi_q16a=DSHI_16B_1_TEXT,
         dshi_q16b=DSHI_16B_2_TEXT,
         dshi_q16c=DSHI_16B_3_TEXT,
         dshi_q16d=DSHI_16B_4_TEXT,
         dshi_q16e=DSHI_16B_5_TEXT,
         dshi_q17=DSHI_17A,
         dshi_q17a=DSHI_17B_1_TEXT,
         dshi_q17b=DSHI_17B_2_TEXT,
         dshi_q17c=DSHI_17B_3_TEXT,
         dshi_q17d=DSHI_17B_4_TEXT,
         dshi_q17e=DSHI_17B_5_TEXT,
         dshi_totalscore=-999)

  
```

Prepare PSS
```{r}
qualtricsData_raw_pss<-filter(qualtricsData_raw_long, grepl("^PSS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_pss<-left_join(qualtricsData_raw_pss,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_pss<-left_join(qualtricsData_raw_pss,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_pss <- qualtricsData_raw_pss %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         visit=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",
                                           NA))))),
         version_form="PSS-10",
         gender="F",
         respondent="Child",
         pssp1_1=PSS_1,
         pssp1_2=PSS_2,
         pssp1_3=PSS_3,
         pssp2_1=ifelse(PSS_4==0,4,
                        ifelse(PSS_4==1,3,
                               ifelse(PSS_4==2,2,
                                      ifelse(PSS_4==3,1,
                                             ifelse(PSS_4==4,0,
                                                    88))))),
         pssp2_2=ifelse(PSS_5==0,4,
                        ifelse(PSS_5==1,3,
                               ifelse(PSS_5==2,2,
                                      ifelse(PSS_5==3,1,
                                             ifelse(PSS_5==4,0,
                                                    88))))),
         pssp2_4=ifelse(PSS_7==0,4,
                        ifelse(PSS_7==1,3,
                               ifelse(PSS_7==2,2,
                                      ifelse(PSS_7==3,1,
                                             ifelse(PSS_7==4,0,
                                                    88))))),
         pssp2_5=ifelse(PSS_8==0,4,
                        ifelse(PSS_8==1,3,
                               ifelse(PSS_8==2,2,
                                      ifelse(PSS_8==3,1,
                                             ifelse(PSS_8==4,0,
                                                    88))))),
         
         pssp2_3=PSS_6,
         pssp3_1=PSS_9,
         pssp3_4=PSS_10,
         pss_totalscore=rowSums(cbind(pssp1_1,pssp1_2,pssp1_3,pssp2_1,pssp2_2,pssp2_3,pssp2_4,pssp2_5,pssp3_1,pssp3_4), na.rm=T))

```

Prepare BFI-10
```{r}
qualtricsData_raw_bfi10<-filter(qualtricsData_raw_long, grepl("BFI",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)



survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_bfi10<-left_join(qualtricsData_raw_bfi10,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_bfi10<-left_join(qualtricsData_raw_bfi10,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_bfi10 <- qualtricsData_raw_bfi10 %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         bfi10_2=BFI_10_2,
         bfi10_6=BFI_10_6,
         bfi10_8=BFI_10_8,
         bfi10_9=BFI_10_9) %>%
  mutate(bfi10_1=ifelse(BFI_10_1==1,5,
                        ifelse(BFI_10_1==2,4,
                               ifelse(BFI_10_1==3,3,
                                      ifelse(BFI_10_1==4,2,
                                             ifelse(BFI_10_1==5,1,
                                                    BFI_10_1))))),
         bfi10_3=ifelse(BFI_10_3==1,5,
                        ifelse(BFI_10_3==2,4,
                               ifelse(BFI_10_3==3,3,
                                      ifelse(BFI_10_3==4,2,
                                             ifelse(BFI_10_3==5,1,
                                                    BFI_10_3))))),
         bfi10_4=ifelse(BFI_10_4==1,5,
                        ifelse(BFI_10_4==2,4,
                               ifelse(BFI_10_4==3,3,
                                      ifelse(BFI_10_4==4,2,
                                             ifelse(BFI_10_4==5,1,
                                                    BFI_10_4))))),
         bfi10_5=ifelse(BFI_10_5==1,5,
                        ifelse(BFI_10_5==2,4,
                               ifelse(BFI_10_5==3,3,
                                      ifelse(BFI_10_5==4,2,
                                             ifelse(BFI_10_5==5,1,
                                                    BFI_10_5))))),
         bfi10_7=ifelse(BFI_10_7==1,5,
                        ifelse(BFI_10_7==2,4,
                               ifelse(BFI_10_7==3,3,
                                      ifelse(BFI_10_7==4,2,
                                             ifelse(BFI_10_7==5,1,
                                                    BFI_10_7))))),
         bfi10_10=ifelse(BFI_10_10==1,5,
                        ifelse(BFI_10_10==2,4,
                               ifelse(BFI_10_10==3,3,
                                      ifelse(BFI_10_10==4,2,
                                             ifelse(BFI_10_10==5,1,
                                                    BFI_10_10))))),
  
      bfi10_extra:=rowSums(cbind(bfi10_1,bfi10_6), na.rm=T),
      bfi10_agree:=rowSums(cbind(bfi10_2,bfi10_7), na.rm=T),
      bfi10_consc:=rowSums(cbind(bfi10_3,bfi10_8), na.rm=T),
      bfi10_neuro:=rowSums(cbind(bfi10_4,bfi10_9), na.rm=T),
      bfi10_open:=rowSums(cbind(bfi10_5,bfi10_10), na.rm=T))
           


```

Prepare EHI
```{r}

qualtricsData_raw_edinburgh_hand<-filter(qualtricsData_raw_long, grepl("^EHI",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_edinburgh_hand<-left_join(qualtricsData_raw_edinburgh_hand,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_edinburgh_hand<-left_join(qualtricsData_raw_edinburgh_hand,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_edinburgh_hand <- qualtricsData_raw_edinburgh_hand %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         visit=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",
                                           NA))))),
         writing=ifelse(EHI_1==1,"spl",
                        ifelse(EHI_1==2,"left",
                               ifelse(EHI_1==3,"np",
                                      ifelse(EHI_1==4,"right",
                                             ifelse(EHI_1==5,"spr",
                                                    NA))))),
         drawing=ifelse(EHI_2==1,"spl",
                        ifelse(EHI_2==2,"left",
                               ifelse(EHI_2==3,"np",
                                      ifelse(EHI_2==4,"right",
                                             ifelse(EHI_2==5,"spr",
                                                    NA))))),
         throwing=ifelse(EHI_3==1,"spl",
                        ifelse(EHI_3==2,"left",
                               ifelse(EHI_3==3,"np",
                                      ifelse(EHI_3==4,"right",
                                             ifelse(EHI_3==5,"spr",
                                                    NA))))),
         scissors=ifelse(EHI_4==1,"spl",
                        ifelse(EHI_4==2,"left",
                               ifelse(EHI_4==3,"np",
                                      ifelse(EHI_4==4,"right",
                                             ifelse(EHI_4==5,"spr",
                                                    NA))))),
         toothbrush=ifelse(EHI_5==1,"spl",
                        ifelse(EHI_5==2,"left",
                               ifelse(EHI_5==3,"np",
                                      ifelse(EHI_5==4,"right",
                                             ifelse(EHI_5==5,"spr",
                                                    NA))))),
         knife_no_fork=ifelse(EHI_6==1,"spl",
                        ifelse(EHI_6==2,"left",
                               ifelse(EHI_6==3,"np",
                                      ifelse(EHI_6==4,"right",
                                             ifelse(EHI_6==5,"spr",
                                                    NA))))),
         spoon=ifelse(EHI_7==1,"spl",
                        ifelse(EHI_7==2,"left",
                               ifelse(EHI_7==3,"np",
                                      ifelse(EHI_7==4,"right",
                                             ifelse(EHI_7==5,"spr",
                                                    NA))))),
         broom=ifelse(EHI_8==1,"spl",
                        ifelse(EHI_8==2,"left",
                               ifelse(EHI_8==3,"np",
                                      ifelse(EHI_8==4,"right",
                                             ifelse(EHI_8==5,"spr",
                                                    NA))))),
         match=ifelse(EHI_9==1,"spl",
                        ifelse(EHI_9==2,"left",
                               ifelse(EHI_9==3,"np",
                                      ifelse(EHI_9==4,"right",
                                             ifelse(EHI_9==5,"spr",
                                                    NA))))),
         box=ifelse(EHI_10==1,"spl",
                        ifelse(EHI_10==2,"left",
                               ifelse(EHI_10==3,"np",
                                      ifelse(EHI_10==4,"right",
                                             ifelse(EHI_10==5,"spr",
                                                    NA))))),
         foot=ifelse(EHI_11==1,"spl",
                        ifelse(EHI_11==2,"left",
                               ifelse(EHI_11==3,"np",
                                      ifelse(EHI_11==4,"right",
                                             ifelse(EHI_11==5,"spr",
                                                    NA))))),
         eye=ifelse(EHI_12==1,"spl",
                        ifelse(EHI_12==2,"left",
                               ifelse(EHI_12==3,"np",
                                      ifelse(EHI_12==4,"right",
                                             ifelse(EHI_12==5,"spr",
                                                    NA))))))

```

Prepare SPPA
```{r}
qualtricsData_raw_sppa<-filter(qualtricsData_raw_long, grepl("SPPA",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_sppa<-left_join(qualtricsData_raw_sppa,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_sppa<-left_join(qualtricsData_raw_sppa,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_sppa <- qualtricsData_raw_sppa %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         version_form="SPPA 2012 Revision",
         ha1=ifelse(SPPA_1==10 & SPPA_2==2,4,
                    ifelse(SPPA_1==10 & SPPA_2==1,3,
                           ifelse(SPPA_1==2 & SPPA_2==1,2,
                                      ifelse(SPPA_1==2 & SPPA_2==2,1,
                                                    NA)))),
         ha2=ifelse(SPPA_3==0 & SPPA_4==2,1,
                    ifelse(SPPA_3==0 & SPPA_4==1,2,
                           ifelse(SPPA_3==2 & SPPA_4==1,3,
                                      ifelse(SPPA_3==2 & SPPA_4==2,4,
                                                    NA)))),
         ha3=ifelse(SPPA_5==0 & SPPA_6==2,4,
                    ifelse(SPPA_5==0 & SPPA_6==1,3,
                           ifelse(SPPA_5==2 & SPPA_6==1,2,
                                      ifelse(SPPA_5==2 & SPPA_6==2,1,
                                                    NA)))),
         ha4=ifelse(SPPA_7==0 & SPPA_8==2,1,
                    ifelse(SPPA_7==0 & SPPA_8==1,2,
                           ifelse(SPPA_7==2 & SPPA_8==1,3,
                                      ifelse(SPPA_7==2 & SPPA_8==2,4,
                                                    NA)))),
         ha7=ifelse(SPPA_9==0 & SPPA_10==2,4,
                    ifelse(SPPA_9==0 & SPPA_10==1,3,
                           ifelse(SPPA_9==2 & SPPA_10==1,2,
                                      ifelse(SPPA_9==2 & SPPA_10==2,1,
                                                    NA)))),
         ha8=ifelse(SPPA_11==0 & SPPA_12==2,4,
                    ifelse(SPPA_11==0 & SPPA_12==1,3,
                           ifelse(SPPA_11==2 & SPPA_12==1,2,
                                      ifelse(SPPA_11==2 & SPPA_12==2,1,
                                                    NA)))),
         ha9=ifelse(SPPA_13==0 & SPPA_14==2,1,
                    ifelse(SPPA_13==0 & SPPA_14==1,2,
                           ifelse(SPPA_13==2 & SPPA_14==1,3,
                                      ifelse(SPPA_13==2 & SPPA_14==2,4,
                                                    NA)))),
         ha10=ifelse(SPPA_15==0 & SPPA_16==2,1,
                    ifelse(SPPA_15==0 & SPPA_16==1,2,
                           ifelse(SPPA_15==2 & SPPA_16==1,3,
                                      ifelse(SPPA_15==2 & SPPA_16==2,4,
                                                    NA)))),
         ha11=ifelse(SPPA_17==0 & SPPA_18==2,4,
                    ifelse(SPPA_17==0 & SPPA_18==1,3,
                           ifelse(SPPA_17==2 & SPPA_18==1,2,
                                      ifelse(SPPA_17==2 & SPPA_18==2,1,
                                                    NA)))),
         ha12=ifelse(SPPA_19==0 & SPPA_20==2,4,
                    ifelse(SPPA_19==0 & SPPA_20==1,3,
                           ifelse(SPPA_19==2 & SPPA_20==1,2,
                                      ifelse(SPPA_19==2 & SPPA_20==2,1,
                                                    NA)))),
         ha13=ifelse(SPPA_21==0 & SPPA_22==2,1,
                    ifelse(SPPA_21==0 & SPPA_22==1,2,
                           ifelse(SPPA_21==2 & SPPA_22==1,3,
                                      ifelse(SPPA_21==2 & SPPA_22==2,4,
                                                    NA)))),
         ha16=ifelse(SPPA_23==0 & SPPA_24==2,1,
                    ifelse(SPPA_23==0 & SPPA_24==1,2,
                           ifelse(SPPA_23==2 & SPPA_24==1,3,
                                      ifelse(SPPA_23==2 & SPPA_24==2,4,
                                                    NA)))),
         ha17=ifelse(SPPA_25==0 & SPPA_26==2,1,
                    ifelse(SPPA_25==0 & SPPA_26==1,2,
                           ifelse(SPPA_25==2 & SPPA_26==1,3,
                                      ifelse(SPPA_25==2 & SPPA_26==2,4,
                                                    NA)))),
         ha18=ifelse(SPPA_27==0 & SPPA_28==2,1,
                    ifelse(SPPA_27==0 & SPPA_28==1,2,
                           ifelse(SPPA_27==2 & SPPA_28==1,3,
                                      ifelse(SPPA_27==2 & SPPA_28==2,4,
                                                    NA)))),
         ha19=ifelse(SPPA_29==0 & SPPA_30==2,4,
                    ifelse(SPPA_29==0 & SPPA_30==1,3,
                           ifelse(SPPA_29==2 & SPPA_30==1,2,
                                      ifelse(SPPA_29==2 & SPPA_30==2,1,
                                                    NA)))),
         ha20=ifelse(SPPA_31==0 & SPPA_32==2,1,
                    ifelse(SPPA_31==0 & SPPA_32==1,2,
                           ifelse(SPPA_31==2 & SPPA_32==1,3,
                                      ifelse(SPPA_31==2 & SPPA_32==2,4,
                                                    NA)))),
         ha21=ifelse(SPPA_33==0 & SPPA_34==2,4,
                    ifelse(SPPA_33==0 & SPPA_34==1,3,
                           ifelse(SPPA_33==2 & SPPA_34==1,2,
                                      ifelse(SPPA_33==2 & SPPA_34==2,1,
                                                    NA)))),
         ha22=ifelse(SPPA_35==0 & SPPA_36==2,1,
                    ifelse(SPPA_35==0 & SPPA_36==1,2,
                           ifelse(SPPA_35==2 & SPPA_36==1,3,
                                      ifelse(SPPA_35==2 & SPPA_36==2,4,
                                                    NA)))),
         ha25=ifelse(SPPA_37==0 & SPPA_38==2,4,
                    ifelse(SPPA_37==0 & SPPA_38==1,3,
                           ifelse(SPPA_37==2 & SPPA_38==1,2,
                                      ifelse(SPPA_37==2 & SPPA_38==2,1,
                                                    NA)))),
         ha26=ifelse(SPPA_39==1 & SPPA_40==2,4,
                    ifelse(SPPA_39==1 & SPPA_40==1,3,
                           ifelse(SPPA_39==2 & SPPA_40==1,2,
                                      ifelse(SPPA_39==2 & SPPA_40==2,1,
                                                    NA)))),
         ha27=ifelse(SPPA_41==1 & SPPA_42==2,4,
                    ifelse(SPPA_41==1 & SPPA_42==1,3,
                           ifelse(SPPA_41==2 & SPPA_42==1,2,
                                      ifelse(SPPA_41==2 & SPPA_42==2,1,
                                                    NA)))),
         ha28=ifelse(SPPA_43==1 & SPPA_44==2,1,
                    ifelse(SPPA_43==1 & SPPA_44==1,2,
                           ifelse(SPPA_43==2 & SPPA_44==1,3,
                                      ifelse(SPPA_43==2 & SPPA_44==2,4,
                                                    NA)))),
         ha29=ifelse(SPPA_45==1 & SPPA_46==2,4,
                    ifelse(SPPA_45==1 & SPPA_46==1,3,
                           ifelse(SPPA_45==2 & SPPA_46==1,2,
                                      ifelse(SPPA_45==2 & SPPA_46==2,1,
                                                    NA)))),
         ha30=ifelse(SPPA_47==1 & SPPA_48==2,1,
                    ifelse(SPPA_47==1 & SPPA_48==1,2,
                           ifelse(SPPA_47==2 & SPPA_48==1,3,
                                      ifelse(SPPA_47==2 & SPPA_48==2,4,
                                                    NA)))),
         ha31=ifelse(SPPA_49==1 & SPPA_50==2,4,
                    ifelse(SPPA_49==1 & SPPA_50==1,3,
                           ifelse(SPPA_49==2 & SPPA_50==1,2,
                                      ifelse(SPPA_49==2 & SPPA_50==2,1,
                                                    NA)))),
         ha34=ifelse(SPPA_51==1 & SPPA_52==2,1,
                    ifelse(SPPA_51==1 & SPPA_52==1,2,
                           ifelse(SPPA_51==2 & SPPA_52==1,3,
                                      ifelse(SPPA_51==2 & SPPA_52==2,4,
                                                    NA)))),
         ha35=ifelse(SPPA_53==0 & SPPA_54==2,1,
                    ifelse(SPPA_53==0 & SPPA_54==1,2,
                           ifelse(SPPA_53==2 & SPPA_54==1,3,
                                      ifelse(SPPA_53==2 & SPPA_54==2,4,
                                                    NA)))),
         ha36=ifelse(SPPA_55==0 & SPPA_56==2,4,
                    ifelse(SPPA_55==0 & SPPA_56==1,3,
                           ifelse(SPPA_55==2 & SPPA_56==1,2,
                                      ifelse(SPPA_55==2 & SPPA_56==2,1,
                                                    NA)))),
         ha37=ifelse(SPPA_57==0 & SPPA_58==2,4,
                    ifelse(SPPA_57==0 & SPPA_58==1,3,
                           ifelse(SPPA_57==2 & SPPA_58==1,2,
                                      ifelse(SPPA_57==2 & SPPA_58==2,1,
                                                    NA)))),
         ha38=ifelse(SPPA_59==0 & SPPA_60==2,4,
                    ifelse(SPPA_59==0 & SPPA_60==1,3,
                           ifelse(SPPA_59==2 & SPPA_60==1,2,
                                      ifelse(SPPA_59==2 & SPPA_60==2,1,
                                                    NA)))),
         ha39=ifelse(SPPA_61==0 & SPPA_62==2,1,
                    ifelse(SPPA_61==0 & SPPA_62==1,2,
                           ifelse(SPPA_61==2 & SPPA_62==1,3,
                                      ifelse(SPPA_61==2 & SPPA_62==2,4,
                                                    NA)))),
         ha40=ifelse(SPPA_63==0 & SPPA_64==2,4,
                    ifelse(SPPA_63==0 & SPPA_64==1,3,
                           ifelse(SPPA_63==2 & SPPA_64==1,2,
                                      ifelse(SPPA_63==2 & SPPA_64==2,1,
                                                    NA)))),
         ha43=ifelse(SPPA_65==0 & SPPA_66==2,4,
                    ifelse(SPPA_65==0 & SPPA_66==1,3,
                           ifelse(SPPA_65==2 & SPPA_66==1,2,
                                      ifelse(SPPA_65==2 & SPPA_66==2,1,
                                                    NA)))),
         ha44=ifelse(SPPA_67==0 & SPPA_68==2,1,
                    ifelse(SPPA_67==0 & SPPA_68==1,2,
                           ifelse(SPPA_67==2 & SPPA_68==1,3,
                                      ifelse(SPPA_67==2 & SPPA_68==2,4,
                                                    NA)))),
         ha45=ifelse(SPPA_69==0 & SPPA_70==2,4,
                    ifelse(SPPA_69==0 & SPPA_70==1,3,
                           ifelse(SPPA_69==2 & SPPA_70==1,2,
                                      ifelse(SPPA_69==2 & SPPA_70==2,1,
                                                    NA)))))

```

Prepare SCC
```{r}
qualtricsData_raw_scc<-filter(qualtricsData_raw_long, grepl("SCC",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)


survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_scc<-left_join(qualtricsData_raw_scc,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_scc<-left_join(qualtricsData_raw_scc,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_scc <- qualtricsData_raw_scc %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         scc_1=ifelse(SCC_1==1,5,
                        ifelse(SCC_1==2,4,
                               ifelse(SCC_1==3,3,
                                      ifelse(SCC_1==4,2,
                                             ifelse(SCC_1==5,1,
                                                    NA))))),
         scc_2=ifelse(SCC_2==1,5,
                        ifelse(SCC_2==2,4,
                               ifelse(SCC_2==3,3,
                                      ifelse(SCC_2==4,2,
                                             ifelse(SCC_2==5,1,
                                                    NA))))),
         scc_3=ifelse(SCC_3==1,5,
                        ifelse(SCC_3==2,4,
                               ifelse(SCC_3==3,3,
                                      ifelse(SCC_3==4,2,
                                             ifelse(SCC_3==5,1,
                                                    NA))))),
         scc_4=ifelse(SCC_4==1,5,
                        ifelse(SCC_4==2,4,
                               ifelse(SCC_4==3,3,
                                      ifelse(SCC_4==4,2,
                                             ifelse(SCC_4==5,1,
                                                    NA))))),
         scc_5=ifelse(SCC_5==1,5,
                        ifelse(SCC_5==2,4,
                               ifelse(SCC_5==3,3,
                                      ifelse(SCC_5==4,2,
                                             ifelse(SCC_5==5,1,
                                                    NA))))),
         scc_6=SCC_6,
         scc_7=ifelse(SCC_7==1,5,
                        ifelse(SCC_7==2,4,
                               ifelse(SCC_7==3,3,
                                      ifelse(SCC_7==4,2,
                                             ifelse(SCC_7==5,1,
                                                    NA))))),
         scc_8=ifelse(SCC_8==1,5,
                        ifelse(SCC_8==2,4,
                               ifelse(SCC_8==3,3,
                                      ifelse(SCC_8==4,2,
                                             ifelse(SCC_8==5,1,
                                                    NA))))),
         scc_9=ifelse(SCC_9==1,5,
                        ifelse(SCC_9==2,4,
                               ifelse(SCC_9==3,3,
                                      ifelse(SCC_9==4,2,
                                             ifelse(SCC_9==5,1,
                                                    NA))))),
         scc_10=ifelse(SCC_10==1,5,
                        ifelse(SCC_10==2,4,
                               ifelse(SCC_10==3,3,
                                      ifelse(SCC_10==4,2,
                                             ifelse(SCC_10==5,1,
                                                    NA))))),
         scc_11=SCC_11,
         scc_12=ifelse(SCC_12==1,5,
                        ifelse(SCC_12==2,4,
                               ifelse(SCC_12==3,3,
                                      ifelse(SCC_12==4,2,
                                             ifelse(SCC_12==5,1,
                                                    NA))))),
 scc_total:=rowSums(cbind(scc_1,scc_2,scc_3,scc_4,scc_5,scc_6,scc_7,scc_8,scc_9,scc_10,scc_11,scc_12), na.rm=T))
```

Prepare ERQ
```{r}

qualtricsData_raw_emrq<-filter(qualtricsData_raw_long, grepl("ERQ",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_emrq<-left_join(qualtricsData_raw_emrq,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_emrq<-left_join(qualtricsData_raw_emrq,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_emrq <- qualtricsData_raw_emrq %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         version_form="ERQ; Gross & John, 9/03",
         erq_1=ERQ_1,
         erq_2=ERQ_2,
         erq_3=ERQ_3,
         erq_4=ERQ_4,
         erq_5=ERQ_5,
         erq_6=ERQ_6,
         erq_7=ERQ_7,
         erq_8=ERQ_8,
         erq_9=ERQ_9,
         erq_10=ERQ_10,

      erq_reappraisal:=rowSums(cbind(erq_1, erq_3, erq_5, erq_7, erq_8. erq_10), na.rm=T),
      erq_suppression:=rowSums(cbind(erq_2, erq_4, erq_6, erq_9), na.rm=T))

```

Prepare SAQ
```{r}

qualtricsData_raw_saq<-filter(qualtricsData_raw_long, grepl("SAQ",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)


survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_saq<-left_join(qualtricsData_raw_saq,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_saq<-left_join(qualtricsData_raw_saq,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_saq <- qualtricsData_raw_saq %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         sagq_1=SAQ_1,
         sagq_2=SAQ_2,
         sagq_3=SAQ_3,
         sagq_4=SAQ_4,
         sagq_5=SAQ_5,
         sagq_6=SAQ_6,
         sagq_7=SAQ_7,
         sagq_8=SAQ_8,
         sagq_9=SAQ_9,
         sagq_10=SAQ_10,
         sagq_11=SAQ_11,
         sagq_12=SAQ_12,
         sagq_13=SAQ_13,
         sagq_14=SAQ_14,
         sagq_15=SAQ_15,
         sagq_16=SAQ_16,
         sagq_17=SAQ_17,
         sagq_18=SAQ_18,
         sagq_19=SAQ_19,
         sagq_20=SAQ_20,
         sagq_21=SAQ_21,

saq_total:=rowSums(cbind(sagq_1,sagq_2,sagq_3,sagq_4,sagq_5,sagq_6,sagq_7,sagq_8,sagq_9,sagq_10,sagq_11,sagq_12,sagq_13,sagq_14,sagq_15,sagq_16,sagq_17,sagq_18,sagq_19,sagq_20,sagq_21), na.rm=T))
```

Prepare CRQ
```{r}

qualtricsData_raw_crq<-filter(qualtricsData_raw_long, grepl("CRQ",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)


survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_crq<-left_join(qualtricsData_raw_crq,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_crq<-left_join(qualtricsData_raw_crq,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_crq <- qualtricsData_raw_crq %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         corumq_1=CRQ_1,
         corumq_2=CRQ_2,
         corumq_3=CRQ_3,
         corumq_4=CRQ_4,
         corumq_5=CRQ_5,
         corumq_6=CRQ_6,
         corumq_7=CRQ_7,
         corumq_8=CRQ_8,
         corumq_9=CRQ_9,
         corumq_10=CRQ_10,
         corumq_11=CRQ_11,
         corumq_12=CRQ_12,
         corumq_13=CRQ_13,
         corumq_14=CRQ_14,
         corumq_15=CRQ_15,
         corumq_16=CRQ_16,
         corumq_17=CRQ_17,
         corumq_18=CRQ_18,
         corumq_19=CRQ_19,
         corumq_20=CRQ_20,
         corumq_21=CRQ_21,
         corumq_22=CRQ_22,
         corumq_23=CRQ_23,
         corumq_24=CRQ_24,
         corumq_25=CRQ_25,
         corumq_26=CRQ_26,
         corumq_27=CRQ_27,
         corumq_total:=rowSums(cbind(corumq_1,corumq_2,corumq_3,corumq_4,corumq_5,corumq_6,corumq_7,corumq_8,corumq_9,corumq_10,corumq_11,corumq_12,corumq_13,corumq_14,corumq_15,corumq_16,corumq_17,corumq_18,corumq_19,corumq_20,corumq_21,corumq_22,corumq_23,corumq_24,corumq_25,corumq_26,corumq_27), na.rm=T))
```

Prepare CAMM
```{r}
qualtricsData_raw_camm<-filter(qualtricsData_raw_long, grepl("CAMM",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_camm<-left_join(qualtricsData_raw_camm,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_camm<-left_join(qualtricsData_raw_camm,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_camm <- qualtricsData_raw_camm %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
           camm_1=ifelse(CAMM_1==4,0,
                        ifelse(CAMM_1==3,1,
                               ifelse(CAMM_1==2,2,
                                      ifelse(CAMM_1==1,3,
                                             ifelse(CAMM_1==0,4,
                                                    NA))))),
         camm_2=ifelse(CAMM_2==4,0,
                        ifelse(CAMM_2==3,1,
                               ifelse(CAMM_2==2,2,
                                      ifelse(CAMM_2==1,3,
                                             ifelse(CAMM_2==0,4,
                                                    NA))))),
         camm_3=ifelse(CAMM_3==4,0,
                        ifelse(CAMM_3==3,1,
                               ifelse(CAMM_3==2,2,
                                      ifelse(CAMM_3==1,3,
                                             ifelse(CAMM_3==0,4,
                                                    NA))))),
         camm_4=ifelse(CAMM_4==4,0,
                        ifelse(CAMM_4==3,1,
                               ifelse(CAMM_4==2,2,
                                      ifelse(CAMM_4==1,3,
                                             ifelse(CAMM_4==0,4,
                                                    NA))))),
         camm_5=ifelse(CAMM_5==4,0,
                        ifelse(CAMM_5==3,1,
                               ifelse(CAMM_5==2,2,
                                      ifelse(CAMM_5==1,3,
                                             ifelse(CAMM_5==0,4,
                                                    NA))))),
         camm_6=ifelse(CAMM_6==4,0,
                        ifelse(CAMM_6==3,1,
                               ifelse(CAMM_6==2,2,
                                      ifelse(CAMM_6==1,3,
                                             ifelse(CAMM_6==0,4,
                                                    NA))))),
         camm_7=ifelse(CAMM_7==4,0,
                        ifelse(CAMM_7==3,1,
                               ifelse(CAMM_7==2,2,
                                      ifelse(CAMM_7==1,3,
                                             ifelse(CAMM_7==0,4,
                                                    NA))))),
         camm_8=ifelse(CAMM_8==4,0,
                        ifelse(CAMM_8==3,1,
                               ifelse(CAMM_8==2,2,
                                      ifelse(CAMM_8==1,3,
                                             ifelse(CAMM_8==0,4,
                                                    NA))))),
         camm_9=ifelse(CAMM_9==4,0,
                        ifelse(CAMM_9==3,1,
                               ifelse(CAMM_9==2,2,
                                      ifelse(CAMM_9==1,3,
                                             ifelse(CAMM_9==0,4,
                                                    NA))))),
         camm_10=ifelse(CAMM_10==5,0,
                        ifelse(CAMM_10==4,3,
                               ifelse(CAMM_10==3,2,
                                      ifelse(CAMM_10==2,1,
                                             ifelse(CAMM_10==1,0,
                                                    NA))))),
 camm_total:=rowSums(cbind(camm_1,camm_2,camm_3,camm_4,camm_5,camm_6,camm_7,camm_8,camm_9,camm_10), na.rm=T))

```

Prepare DIT
```{r}
qualtricsData_raw_dit<-filter(qualtricsData_raw_long, grepl("DIT",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)



survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_dit<-left_join(qualtricsData_raw_dit,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_dit<-left_join(qualtricsData_raw_dit,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_dit <- qualtricsData_raw_dit %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         gender="F",
         dit_1=DIT_1,
         dit_2=DIT_2,
         dit_3=DIT_3,
         dit_4=DIT_4,
         dit_5=DIT_5,
         dit_6=DIT_6,
         dit_7=DIT_7,
         dit_8=DIT_8,
         dit_9=DIT_9,
         dit_10=DIT_10,
         dit_11=DIT_11,
         dit_12=DIT_12,
         dit_13=DIT_13,
         dit_14=DIT_14,
dit_social:=rowSums(cbind(dit_1,dit_2,dit_3,dit_4), na.rm=T),
dit_social:=rowSums(cbind(dit_5,dit_6,dit_7,dit_8,dit_9,dit_10,dit_11,dit_12,dit_13,dit_14), na.rm=T))
```

Prepare IRI
```{r}
qualtricsData_raw_iri<-filter(qualtricsData_raw_long, grepl("IRI",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_iri<-left_join(qualtricsData_raw_iri,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_iri<-left_join(qualtricsData_raw_iri,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_iri <- qualtricsData_raw_iri %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         gender="F",
         daydream=IRI_1,
         tender_feelings=IRI_2,
         difficult_other_pov=ifelse(IRI_3==0,4,
                                    ifelse(IRI_3==1,3,
                                           ifelse(IRI_3==2,2,
                                                  ifelse(IRI_3==3,1,
                                                         ifelse(IRI_3==4,0,
                                                                NA))))),
         dont_feel_sorry_problems=ifelse(IRI_4==0,4,
                                         ifelse(IRI_4==1,3,
                                                ifelse(IRI_4==2,2,
                                                       ifelse(IRI_4==3,1,
                                                              ifelse(IRI_4==4,0,
                                                                     NA))))),
         involved_characters=IRI_5,
         emergency_apprehension=IRI_6,
         objective_watching=ifelse(IRI_7==0,4,
                                   ifelse(IRI_7==1,3,
                                          ifelse(IRI_7==2,2,
                                                 ifelse(IRI_7==3,1,
                                                        ifelse(IRI_7==4,0,
                                                               NA))))),
         all_sides_disagreement=IRI_8,
         protective=IRI_9,
         helpless=IRI_10,
         other_perspective=IRI_11,
         involved_rare=ifelse(IRI_12==0,4,
                                   ifelse(IRI_12==1,3,
                                          ifelse(IRI_12==2,2,
                                                 ifelse(IRI_12==3,1,
                                                        ifelse(IRI_12==4,0,
                                                               NA))))),
         hurt_stay_calm=ifelse(IRI_13==0,4,
                               ifelse(IRI_13==1,3,
                                      ifelse(IRI_13==2,2,
                                             ifelse(IRI_13==3,1,
                                                    ifelse(IRI_13==4,0,
                                                           NA))))),
         misfortunes_not_disturbed=ifelse(IRI_14==0,4,
                                          ifelse(IRI_14==1,3,
                                                 ifelse(IRI_14==2,2,
                                                        ifelse(IRI_14==3,1,
                                                               ifelse(IRI_14==4,0,
                                                                      NA))))),
         arguments_dont_listen=ifelse(IRI_15==0,4,
                                          ifelse(IRI_15==1,3,
                                                 ifelse(IRI_15==2,2,
                                                        ifelse(IRI_15==3,1,
                                                               ifelse(IRI_15==4,0,
                                                                      NA))))),
         movie_characters=IRI_16,
         tense_emotional=IRI_17,
         unfairly_pity=ifelse(IRI_18==0,4,
                              ifelse(IRI_18==1,3,
                                     ifelse(IRI_18==2,2,
                                            ifelse(IRI_18==3,1,
                                                   ifelse(IRI_18==4,0,
                                                          NA))))),
         effective_emergencies=ifelse(IRI_19==0,4,
                                      ifelse(IRI_19==1,3,
                                             ifelse(IRI_19==2,2,
                                                    ifelse(IRI_19==3,1,
                                                           ifelse(IRI_19==4,0,
                                                                  NA))))),
         touched=IRI_20,
         see_both_sides=IRI_21,
         describe_soft_hearted=IRI_22,
         movie_characters_relate=IRI_23,
         emergencies_lose_control=IRI_24,
         upset_try_shoes=IRI_25,
         novel_if_in_story=IRI_26,
         help_go_to_pieces=IRI_27,
         before_criticizing=IRI_28,
         comments=ifelse(is.na(IRI_1),"Fantasy subscale was not administered.",
                                        ""),
         comments=ifelse(is.na(IRI_5),"Fantasy subscale was not administered.",
                                        ""),
         comments=ifelse(is.na(IRI_7),"Fantasy subscale was not administered.",
                                        ""),
         comments=ifelse(is.na(IRI_12),"Fantasy subscale was not administered.",
                                        ""),
         comments=ifelse(is.na(IRI_16),"Fantasy subscale was not administered.",
                                        ""),
         comments=ifelse(is.na(IRI_23),"Fantasy subscale was not administered.",
                                        ""),
         comments=ifelse(is.na(IRI_26),"Fantasy subscale was not administered.",
                                        ""),
         iri_PT:=rowSums(cbind(difficult_other_pov,all_sides_disagreement,other_perspective,arguments_dont_listen,see_both_sides,upset_try_shoes,before_criticizing), na.rm=T),
         iri_EC:=rowSums(cbind(tender_feelings,dont_feel_sorry_problems,protective,misfortunes_not_disturbed,unfairly_pity,touched,describe_soft_hearted), na.rm=T),
         iri_PD:=rowSums(cbind(emergency_apprehension,helpless,hurt_stay_calm,tense_emotional,effective_emergencies,emergencies_lose_control,help_go_to_pieces), na.rm=T)
         )

```

Prepare IFS 
```{r}
qualtricsData_raw_ifs<-filter(qualtricsData_raw_long, grepl("IFS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)



survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)


qualtricsData_raw_ifs<-left_join(qualtricsData_raw_ifs,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_ifs<-left_join(qualtricsData_raw_ifs,dob, by="tagid") %>% select(-tagid,-value)


qualtricsData_raw_ifs <- qualtricsData_raw_ifs %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         ifs_1=IFS_1,
         ifs_2=IFS_2,
         ifs_3=IFS_3,
         ifs_4=IFS_4,
         ifs_5=IFS_5,
         ifs_6=IFS_6,
         ifs_7=IFS_7,
         ifs_8=IFS_8,
         ifs_9=IFS_9,
         ifs_10=IFS_10,
         ifs_11=IFS_11,
         ifs_12=IFS_12,
         ifs_13=IFS_13,
         ifs_14=IFS_14,
         ifs_15=IFS_15,
         ifs_16=IFS_16,
         ifs_17=IFS_17,
         ifs_18=IFS_18,
         ifs_19=IFS_19,
         ifs_20=IFS_20,
         ifs_21=IFS_21,
         ifs_22=IFS_22,
         ifs_23=IFS_23,
         ifs_24=IFS_24,
         ifs_25=IFS_25,
         ifs_26=IFS_26,
         ifs_27=IFS_27,
         ifs_28=IFS_28,
         ifs_29=IFS_29,
         ifs_30=IFS_30,
         ifs_31=IFS_31,
         ifs_32=IFS_32,
ifs_total:=rowSums(cbind(ifs_1,ifs_2,ifs_3,ifs_4,ifs_5,ifs_6,ifs_7,ifs_8,ifs_9,ifs_10,ifs_11,ifs_12,ifs_13,ifs_14,ifs_15,ifs_16,ifs_17,ifs_18,ifs_19,ifs_20,ifs_21,ifs_22,ifs_23,ifs_24,ifs_25,ifs_26,ifs_27,ifs_28,ifs_29,ifs_30,ifs_31,ifs_32), na.rm=T))
```

Prepare SSDS
```{r}
qualtricsData_raw_ssds<-filter(qualtricsData_raw_long, grepl("SSDS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item)) 

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_ssds<-left_join(qualtricsData_raw_ssds,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_ssds<-left_join(qualtricsData_raw_ssds,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_ssds <- qualtricsData_raw_ssds %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         ssds_1=SSDS_1,
         ssds_2=SSDS_2,
         ssds_3=SSDS_3,
         ssds_4=SSDS_4,
         ssds_5=SSDS_5,
         ssds_6=SSDS_6,
         ssds_7=SSDS_7,
         ssds_8=SSDS_8,
         ssds_9=SSDS_9,
         ssds_10=SSDS_10,
         ssds_11=SSDS_11,
         ssds_12=SSDS_12,
         ssds_13=SSDS_13,
         ssds_14=SSDS_14,
         ssds_15=SSDS_15,
         ssds_16=SSDS_16,
         ssds_17=SSDS_17,
         ssds_18=SSDS_18,
         ssds_19=SSDS_19,
         ssds_20=SSDS_20,
         ssds_21=SSDS_21,
         ssds_22=SSDS_22,
         ssds_23=SSDS_23,

ssds_family:=rowSums(cbind(ssds_1,ssds_2,ssds_3,ssds_4,ssds_5,ssds_6,ssds_7,ssds_8), na.rm=T),
ssds_friendship:=rowSums(cbind(ssds_9,ssds_10,ssds_11,ssds_12,ssds_13,ssds_14,ssds_15), na.rm=T),
ssds_physical:=rowSums(cbind(ssds_16,ssds_17,ssds_18,ssds_19,ssds_20,ssds_21,ssds_22,ssds_23), na.rm=T))
```

Prepare CES-DC 
```{r}
qualtricsData_raw_cesd<-filter(qualtricsData_raw_long, grepl("CES_D",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)


survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_cesd<-left_join(qualtricsData_raw_cesd,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_cesd<-left_join(qualtricsData_raw_cesd,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_cesd <- qualtricsData_raw_cesd %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         version_form="Child version (CES-DC)",
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         bothered_by_things=CES_DC_1,
         appetite_poor=CES_DC_2,
         couldnt_shake_blues=CES_DC_3,
         just_as_good_people=ifelse(CES_DC_4==0,3,
                                ifelse(CES_DC_4==1,2,
                                     ifelse(CES_DC_4==2,1,
                                                   ifelse(CES_DC_4==3,0,
                                                          NA)))),
         trouble_keeping_mind=CES_DC_5,
         felt_depressed=CES_DC_6,
         everything_effort=CES_DC_7,
         hopeful_future=ifelse(CES_DC_8==0,3,
                              ifelse(CES_DC_8==1,2,
                                     ifelse(CES_DC_8==2,1,
                                                   ifelse(CES_DC_8==3,0,
                                                          NA)))),
         failure_life=CES_DC_9,
         fearful=CES_DC_10,
         sleep_restless=CES_DC_11,
         happy=ifelse(CES_DC_12==0,3,
                                ifelse(CES_DC_12==1,2,
                                     ifelse(CES_DC_12==2,1,
                                                   ifelse(CES_DC_12==3,0,
                                                          NA)))),
         talked_less_usual=CES_DC_13,
         felt_lonely=CES_DC_14,
         people_unfriendly=CES_DC_15,
         enjoyed_life=ifelse(CES_DC_16==0,3,
                                ifelse(CES_DC_16==1,2,
                                     ifelse(CES_DC_16==2,1,
                                                   ifelse(CES_DC_16==3,0,
                                                          NA)))),
         crying_spells=CES_DC_17,
         felt_sad=CES_DC_18,
         felt_people_dislike_me=CES_DC_19,
         couldnt_get_going=CES_DC_20,
         rarely_none_total=999,
         occasionally_total=999,
         some_little_total=999,
         most_time_total=999,
ces-dc:=rowSums(cbind(bothered_by_things,appetite_poor,couldnt_shake_blues,just_as_good_people,trouble_keeping_mind,felt_depressed,everything_effort,hopeful_future,failure_life,fearful,sleep_restless,happy,talked_less_usual,felt_lonely,people_unfriendly,enjoyed_life,crying_spells,felt_sad,felt_people_dislike_me,couldnt_get_going), na.rm=T))
```

Prepare SCARED-R 
```{r}
qualtricsData_raw_scared<-filter(qualtricsData_raw_long, grepl("SCARED",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_scared<-left_join(qualtricsData_raw_scared,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_scared<-left_join(qualtricsData_raw_scared,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_scared <- qualtricsData_raw_scared %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         scared_version="Brief",
         visit=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         comments_misc="SCARED Brief Assessment of Anxiety and PTS Symptoms (ages 7-17)",
         scared_24=SCARED_R_1,
         scared_25=SCARED_R_2,
         scared_28=SCARED_R_3,
         scared_36=SCARED_R_4,
         scared_41=SCARED_R_5,
         briefscared_1=SCARED_R_6,
         briefscared_2=SCARED_R_7,
         briefscared_3=SCARED_R_8,
         briefscared_4=SCARED_R_9,
         scared_total=rowSums(cbind(SCARED_R_1,SCARED_R_2,SCARED_R_3,SCARED_R_4,SCARED_R_5),na.rm=T),
         scared_ptsd_score=rowSums(cbind(SCARED_R_6,SCARED_R_7,SCARED_R_8,SCARED_R_9),na.rm=T),
         scared_pd_score=999,
         scared_gad_score=999,
         scared_sad_score=999,
         scared_socad_score=999,
         scared_ssa_score=999)

```

Prepare PBIP
```{r}
qualtricsData_raw_puberty<-filter(qualtricsData_raw_long, grepl("PBIP",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

# 
# qualtricsData_raw_puberty2<-filter(qualtricsData_raw_long, grepl("PDS",item)) %>% mutate(value=as.numeric(value))%>% filter(!is.na(value), tagid %in% current_subs$TAGID,!tagid=="TAG078")%>% distinct(tagid,item,value,.keep_all = TRUE) %>% spread(item,value)
# 
# qualtricsData_raw_puberty<-left_join(qualtricsData_raw_puberty2,qualtricsData_raw_puberty)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_puberty<-left_join(qualtricsData_raw_puberty,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_puberty<-left_join(qualtricsData_raw_puberty,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_puberty <- qualtricsData_raw_puberty%>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         tsmfemale=9,
         tsmmale=9999,
         tsmboth=9,
         tsftsg=PBIP_1,
         tsftphg=PBIP_3)
```

Prepare PDS
```{r}
qualtricsData_raw_pds<-filter(qualtricsData_raw_long, grepl("PDS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)


survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_pds<-left_join(qualtricsData_raw_pds,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_pds<-left_join(qualtricsData_raw_pds,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_pds <- qualtricsData_raw_pds %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         gender="F",
         respond=3,
         pds_1=PDS_F1,
         pds_2=PDS_F2,
         pds_3=PDS_F3,
         pds_6=PDS_F4,
         pds6g=ifelse(PDS_F6==4,1,
                         ifelse(PDS_F6==1,0,
                                PDS_F6)),
         pds_7b_pv=PDS_F5,
         height_std=PDS_F7,
         weight_std=PDS_F8,
         pds_girl_rs=999)
```

Prepare CARE-R Soc
```{r}
qualtricsData_raw_carersoc<-filter(qualtricsData_raw_long, grepl("CARE_R",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_carersoc<-left_join(qualtricsData_raw_carersoc,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_carersoc<-left_join(qualtricsData_raw_carersoc,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_carersoc <- qualtricsData_raw_carersoc %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Wave1 Session1",
                      ifelse(grepl("Session 1",survey_name),"Wave1 Session1",
                             ifelse(grepl("Sess 2",survey_name),"Wave1 Session2",
                                    ifelse(grepl("Session 2",survey_name),"Wave1 Session2",
                                           ifelse(grepl("Home",survey_name),"Wave1 Home Questionnaires",NA))))),
         gender="F",
         version_form="CARE-R Social Outcome Appraisal Questions",
         carersoc_1=CARE_R_I,
         carersoc_2=CARE_R_II,
         carersoc_3=CARE_R_1A,
         carersoc_4=CARE_R_1B,
         carersoc_5=CARE_R_2A,
         carersoc_6=CARE_R_2B,
         carersoc_7=CARE_R_3A,
         carersoc_8=CARE_R_3B,
         carersoc_9=CARE_R_4A,
         carersoc_10=CARE_R_4B,
         carersoc_11=CARE_R_5A,
         carersoc_12=CARE_R_5B,
         carersoc_13=CARE_R_6A,
         carersoc_14=CARE_R_6B,
         carersoc_15=CARE_R_7A,
         carersoc_16=CARE_R_7B,
         carersoc_17=CARE_R_8A,
         carersoc_18=CARE_R_8B,
         carersoc_19=CARE_R_9A,
         carersoc_20=CARE_R_9B,
         carersoc_21=CARE_R_10A,
         carersoc_22=CARE_R_10B,
         carersoc_23=CARE_R_11A,
         carersoc_24=CARE_R_11B,
         carersoc_25=CARE_R_12A,
         carersoc_26=CARE_R_12B,
         carersoc_27=CARE_R_13A,
         carersoc_28=CARE_R_13B,
         carersoc_29=CARE_R_14A,
         carersoc_30=CARE_R_14B)
```

Prepare CTQ
```{r}
qualtricsData_raw_ctq<-filter(qualtricsData_raw_long, grepl("CTQ",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))
#survey_date$value<-as.Date(survey_date$value)

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_ctq<-left_join(qualtricsData_raw_ctq,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_ctq<-left_join(qualtricsData_raw_ctq,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_ctq <- qualtricsData_raw_ctq %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         ctq_01=CTQ_1,
         ctq_02=ifelse(CTQ_2==1,5,
                         ifelse(CTQ_2==2,4,
                                ifelse(CTQ_2==3,3,
                                       ifelse(CTQ_2==4,2,
                                                     CTQ_2==5,1)))),
         ctq_03=CTQ_3,
         ctq_04=CTQ_4,
         ctq_05=ifelse(CTQ_5==1,5,
                         ifelse(CTQ_5==2,4,
                                ifelse(CTQ_5==3,3,
                                       ifelse(CTQ_5==4,2,
                                                     CTQ_5==5,1)))),
         ctq_06=CTQ_6,
         ctq_07=ifelse(CTQ_7==1,5,
                         ifelse(CTQ_7==2,4,
                                ifelse(CTQ_7==3,3,
                                       ifelse(CTQ_7==4,2,
                                                     CTQ_7==5,2)))),
         ctq_08=CTQ_8,
         ctq_09=CTQ_9,
         ctq_10=CTQ_10,
         ctq_11=CTQ_11,
         ctq_12=CTQ_12,
         ctq_13=ifelse(CTQ_13==1,5,
                         ifelse(CTQ_13==2,4,
                                ifelse(CTQ_13==3,3,
                                       ifelse(CTQ_13==4,2,
                                                     CTQ_13==5,1)))),
         ctq_14=CTQ_14,
         ctq_15=CTQ_15,
         ctq_16=CTQ_16,
         ctq_17=CTQ_17,
         ctq_18=CTQ_18,
         ctq_19=ifelse(CTQ_19==1,5,
                         ifelse(CTQ_19==2,4,
                                ifelse(CTQ_19==3,3,
                                       ifelse(CTQ_19==4,2,
                                                     CTQ_19==5,1)))),
         ctq_20=CTQ_20,
         ctq_21=CTQ_21,
         ctq_22=CTQ_22,
         ctq_23=CTQ_23,
         ctq_24=CTQ_24,
         ctq_25=CTQ_25,
         ctq_26=ifelse(CTQ_26==1,5,
                         ifelse(CTQ_26==2,4,
                                ifelse(CTQ_26==3,3,
                                       ifelse(CTQ_26==4,2,
                                                     CTQ_26..1==5,1)))),
         ctq_27=CTQ_27,
         ctq_28=CTQ_28,
         ctq_total:=rowSums(cbind(ctq_01,ctq_02,ctq_03,ctq_04,ctq_05,ctq_06,ctq_07,ctq_08,ctq_09,ctq_10,ctq_11,ctq_12,ctq_13,ctq_14,ctq_15,ctq_16,ctq_17,ctq_18,ctq_19,ctq_20,ctq_21,ctq_22,ctq_23,ctq_24,ctq_25,ctq_26,ctq_27,ctq_28), na.rm=T))
```

Prepare PANAS-C
```{r}
qualtricsData_raw_panasc<-filter(qualtricsData_raw_long, grepl("PANAS",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

survey_date<-filter(qualtricsData_raw_long, grepl("EndDate",item))

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_panasc<-left_join(qualtricsData_raw_panasc,survey_date, by = c("tagid", "survey_name")) %>% select(-item) %>% mutate(src_subject_id=tagid, survey_date=value)
qualtricsData_raw_panasc<-left_join(qualtricsData_raw_panasc,dob, by="tagid") %>% select(-tagid,-value)

qualtricsData_raw_panasc <- qualtricsData_raw_panasc %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
        panas_21=PANAS_C_1,
        panas_15=PANAS_C_2,
        panas_17=PANAS_C_3,
        panas_23=PANAS_C_4,
        panas_8=PANAS_C_5,
        panas_20=PANAS_C_6,
        panas_30=PANAS_C_7,
        panas_13=PANAS_C_8,
        panas_19=PANAS_C_9,
        panas_2=PANAS_C_10,
        sum_pos=-9,
        sum_neg=-9)
```

Prepare Parent CBCL (some errors, need to check out)
```{r}
qualtricsData_raw_parent<-filter(qualtricsData_raw_long, grepl("Parent",item)) %>% 
  mutate(value=as.numeric(value)) %>% 
  filter(!is.na(value)) %>% 
  distinct(tagid,item,value,.keep_all = TRUE) %>% 
  spread(item,value)

dob <- participant_info %>%
  select(tagid, dob)

qualtricsData_raw_parent<-left_join(qualtricsData_raw_parent,dob, by="tagid") %>% mutate(survey_date=EndDate,src_subject_id=tagid) %>%select(-tagid,-EndDate)

qualtricsData_raw_parent <- qualtricsData_raw_parent %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         gender="F",
         comments_misc="Parent filled out for child",
         sports_des1=I_Sports_1_TEXT,
         sports_des2=I_Sports_2_TEXT,
         sports_des3=I_Sports_3_TEXT,
         sports_time1=as.numeric(Sport_Time_1),
         sports_well1=as.numeric(Sport_Well_1),
         sports_time2=as.numeric(Sport_Time_2),
         sports_well2=as.numeric(Sport_Well_2),
         sports_time3=as.numeric(Sport_Time_3),
         sports_well3=as.numeric(Sport_Well_3),
         activities_des1=II_Hobbies_1_TEXT,
         activities_time1=(as.numeric(Hobby_Time_1)-1),
         activities_well1=(as.numeric(Hobby_Well_1)-1),
         activities_des2=II_Hobbies_2_TEXT,
         activities_time2=(as.numeric(Hobby_Time_2)-1),
         activities_well2=(as.numeric(Hobby_Well_2)-1),
         activities_des3=II_Hobbies_3_TEXT,
         activities_time3=(as.numeric(Hobby_Time_3)-1),
         activities_well3=(as.numeric(Hobby_Well_3)-1),
         clubs_des1=III_Clubs_1_TEXT,
         clubs_active1=(as.numeric(ClubActive_1)-1),
         clubs_des2=III_Clubs_2_TEXT,
         clubs_active2=(as.numeric(ClubActive_2)-1),
         clubs_des3=III_Clubs_3_TEXT,
         clubs_active3=(as.numeric(ClubActive_3)-1),
         chores_des1=IV_Chores_1_TEXT,
         chores_well1=(as.numeric(Chore_Well_1)-1),
         chores_des2=IV_Chores_2_TEXT,
         chores_well2=(as.numeric(Chore_Well_2)-1),
         chores_des3=IV_Chores_3_TEXT,
         chores_well3=(as.numeric(Chore_Well_3)-1),
         friends=V_Friends,
         friends_time=FriendTime,
         interp_siblings=(as.numeric(How_Well_Get_Along_Sibs)-1),
         interp_kids=(as.numeric(How_Well_Get_Along_Kids)-1),
         interp_parents=(as.numeric(How_Well_Behave_Parents)-1),
         interp_alone=(as.numeric(How_Well_Play_Work_Alone)-1),
         cbcl1=VIII_1,
         cbcl2=VIII_2,
         cbcl3=VIII_3,
         cbcl4=VIII_4,
         cbcl5=VIII_5,
         cbcl6=VIII_6,
         cbcl7=VIII_7,
         cbcl8=VIII_8,
         cbcl9=VIII_9,
         cbcl10=VIII_10,
         cbcl11=VIII_11,
         cbcl12=VIII_12,
         cbcl13=VIII_13,
         cbcl14=VIII_14,
         cbcl15=VIII_15,
         cbcl16=VIII_16,
         cbcl17=VIII_17,
         cbcl18=VIII_18,
         cbcl19=VIII_19,
         cbcl20=VIII_20,
         cbcl21=VIII_21,
         cbcl22=VIII_22,
         cbcl23=VIII_23,
         cbcl24=VIII_24,
         cbcl25=VIII_25,
         cbcl26=VIII_26,
         cbcl27=VIII_27,
         cbcl28=VIII_28,
         cbcl29=VIII_29,
         cbcl30=VIII_30,
         cbcl31=VIII_31,
         cbcl32=VIII_32,
         cbcl33=VIII_33,
         cbcl34=VIII_34,
         cbcl35=VIII_35,
         cbcl36=VIII_36,
         cbcl37=VIII_37,
         cbcl38=VIII_38,
         cbcl39=VIII_39,
         cbcl40=VIII_40,
         cbcl41=VIII_41,
         cbcl42=VIII_42,
         cbcl43=VIII_43,
         cbcl44=VIII_44,
         cbcl45=VIII_45,
         cbcl46=VIII_46,
         cbcl47=VIII_47,
         cbcl48=VIII_48,
         cbcl49=VIII_49,
         cbcl50=VIII_50,
         cbcl51=VIII_51,
         cbcl52=VIII_52,
         cbcl53=VIII_53,
         cbcl54=VIII_54,
         cbcl55=VIII_55,
         cbcl56a=VIII_56a,
         cbcl56b=VIII_56b,
         cbcl56c=VIII_56c,
         cbcl56d=VIII_56d,
         cbcl56e=VIII_56e,
         cbcl56f=VIII_56f,
         cbcl56g=VIII_56g,
         cbcl56h=as.numeric(VIII_56h),
         cbcl57=VIII_57,
         cbcl58=VIII_58,
         cbcl59=VIII_59,
         cbcl60=VIII_60,
         cbcl61=VIII_61,
         cbcl62=VIII_62,
         cbcl63=VIII_63,
         cbcl64=VIII_64,
         cbcl65=VIII_65,
         cbcl66=VIII_66,
         cbcl67=VIII_67,
         cbcl68=VIII_68,
         cbcl69=VIII_69,
         cbcl70=as.numeric(VIII_70),
         cbcl71=VIII_71,
         cbcl72=VIII_72,
         cbcl73=VIII_73,
         cbcl74=VIII_74,
         cbcl75=VIII_75,
         cbcl76=VIII_76,
         cbcl77=VIII_77,
         cbcl78=VIII_78,
         cbcl79=VIII_79,
         cbcl80=VIII_80,
         cbcl81=VIII_81,
         cbcl82=VIII_82,
         cbcl83=VIII_83,
         cbcl84=VIII_84,
         cbcl85=VIII_85,
         cbcl86=VIII_86,
         cbcl87=VIII_87,
         cbcl88=VIII_88,
         cbcl89=VIII_89,
         cbcl90=VIII_90,
         cbcl91=VIII_91,
         cbcl92=VIII_92,
         cbcl93=VIII_93,
         cbcl94=VIII_94,
         cbcl95=VIII_95,
         cbcl96=VIII_96,
         cbcl97=VIII_97,
         cbcl98=VIII_98,
         cbcl99=VIII_99,
         cbcl100=VIII_100,
         cbcl101=VIII_101,
         cbcl102=VIII_102,
         cbcl103=VIII_103,
         cbcl104=VIII_104,
         cbcl105=VIII_105,
         cbcl106=VIII_106,
         cbcl107=VIII_107,
         cbcl108=VIII_108,
         cbcl109=VIII_109,
         cbcl110=VIII_110,
         cbcl111=VIII_111,
         cbcl112=VIII_112,
         cbcl_emotional_raw=999,
         cbcl_emotional=999,
         cbcl_anxious_raw=999,
         cbcl_anxious=999,
         cbcl_somatic_c_raw=999,
         cbcl_somatic_c=999,
         cbcl_withdrawn_raw=999,
         cbcl_withdrawn=999,
         cbcl_sleep_raw=999,
         cbcl_sleep=999,
         cbcl_attention_raw=999,
         cbcl_attention=999,
         cbcl_aggressive_raw=999,
         cbcl_aggressive=999,
         cbcl_internal_raw=999,
         cbcl_internal=999,
         cbcl_external_raw=999,
         cbcl_external=999,
         cbcl_total_raw=999,
         cbcl_total=999,
         cbcl_affective_raw=999,
         cbcl_affective=999,
         cbcl_anxiety_raw=999,
         cbcl_anxiety=999,
         cbcl_pervasive_raw=999,
         cbcl_pervasive=999,
         cbcl_adhd_raw=999,
         cbcl_adhd=999,
         cbcl_oppositional_raw=999,
         cbcl_oppositional=999,
         cbcl_social_p_raw=999,
         cbcl_social_p=999,
         cbcl_thought_raw=999,
         cbcl_thought=999,
         cbcl_rulebreak_raw=999,
         cbcl_rulebreak=999,
         cbcl_activities_raw=999,
         cbcl_activities=999,
         cbcl_social_c_raw=999,
         cbcl_social_c=999,
         cbcl_school_raw=999,
         cbcl_school=999,
         cbcl_total_c_raw=999,
         cbcl_total_c=999,
         cbcl_somatic_p_raw=999,
         cbcl_somatic_p=999,
         cbcl_conduct_raw=999,
         cbcl_conduct=999,
         cbcl_sct_raw=999,
         cbcl_sct=999,
         cbcl_ocd_raw=999,
         cbcl_ocd=999,
         cbcl_ptsd_raw=999,
         cbcl_ptsd=999,
         cbcl_depresspr=999,
         cbcl_depresspr_raw=999) %>%
  select(1:2,340:554)
```
